name: Automated Commit Review

on:
  push:
    branches:
      - '**'

jobs:
  start-review:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Start review on pushed commits
        uses: actions/github-script@v7
        with:
          script: |
            if (context.payload.deleted) {
              core.info('Push corresponds to a branch/tag deletion; skipping review.');
              return;
            }

            const commits = context.payload.commits ?? [];
            if (commits.length === 0) {
              core.info('No commits found in push payload.');
              return;
            }

            for (const commit of commits) {
              await github.rest.repos.createCommitComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                commit_sha: commit.id,
                body: 'Automated review started for this commit.'
              });
              core.info(`Started review for commit ${commit.id}`);
            }
